{{template "header" .}}
<h1>Termine</h1>

<style>
  .calendar-dot {
    display: inline-block;
    width: 0.9em;
    height: 0.9em;
    border-radius: 50%;
    margin-right: 0.5em;
    vertical-align: middle;
  }
  .calendar-sidebar-bg {
    background: #f8f9fa;
    min-height: 100%;
    border-radius: 0.5rem;
    padding-top: 1rem;
    padding-bottom: 1rem;
  }
  .calendar-download-btn {
    padding: 0.25rem 0.5rem;
    margin-left: 0.5em;
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
  }
  .calendar-download-btn:focus {
    outline: none;
    box-shadow: none;
  }
  .calendar-btn-row {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 0.5em;
    align-items: center;
    width: 100%;
  }
  .calendar-btn-row > .btn {
    width: 100%;
  }
  @media (max-width: 767px) {
    .calendar-sidebar-bg {
      border-radius: 0;
      min-height: unset;
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
    }
  }
</style>

<form id="calendar-form" method="get" class="mb-4">
  <div class="row">
    <!-- Sidebar for all screen sizes -->
    <div class="col-md-3 col-12 mb-3 mb-md-0">
      <div class="calendar-sidebar-bg">
        <div class="btn-group-vertical w-100" role="group" aria-label="Kalenderauswahl">
          {{range $i, $cal := .Calendars}}
            <div class="calendar-btn-row mb-2">
              <button type="button"
                class="btn btn-sm {{if index $.ActiveCals $cal}}btn-{{index $.CalBtnClasses $cal}}{{else}}btn-outline-{{index $.CalBtnClasses $cal}}{{end}} d-flex align-items-center justify-content-center"
                onclick="toggleCalendar('{{$cal}}')">
                {{$cal | title}}
              </button>
              <a class="calendar-download-btn" href="{{index $.CalWebcalURLs $cal | safeURL}}" rel="noopener" title="Kalender abonnieren">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cloud-download" viewBox="0 0 16 16">
                  <path d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383"/>
                  <path d="M7.646 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V5.5a.5.5 0 0 0-1 0v8.793l-2.146-2.147a.5.5 0 0 0-.708.708z"/>
                </svg>
              </a>
            </div>
          {{end}}
        </div>
      </div>
      <input type="hidden" name="calendar" id="calendar-input" value="{{.Calendar}}">
      <input type="hidden" name="lang" value="{{.Lang}}">
    </div>
    <!-- Main content -->
    <div class="col-md-9">
      {{if .Events}}
      <div class="container-fluid px-0">
        <div class="row">
          <div class="col-12">
            {{range $idx, $e := .Events}}
              <div class="card mb-3">
                <div class="card-header d-flex align-items-center" style="cursor:pointer;" data-bs-toggle="collapse" data-bs-target="#event-desc-{{$idx}}" aria-expanded="false" aria-controls="event-desc-{{$idx}}">
                  <span class="calendar-dot" style="background: {{index $.CalColors $e.Calendar}}"></span>
                  <h5 class="mb-0 d-inline">{{ $e.Summary }}</h5>
                  <div class="ms-auto">
                    <span class="text-muted">{{ $e.Start }}</span>
                    {{if $e.Duration}}<span class="ms-2 text-muted">({{ $e.Duration }})</span>{{end}}
                  </div>
                </div>
                <div id="event-desc-{{$idx}}" class="collapse">
                  <div class="card-body">
                    {{if $e.End}}<p class="card-text"><strong>Ende:</strong> {{ $e.End }}</p>{{end}}
                    {{if $e.Location}}<p class="card-text"><strong>Ort:</strong> {{ $e.Location }}</p>{{end}}
                    {{if $e.Description}}<p class="card-text">{{ $e.Description }}</p>{{else}}<em>Keine Beschreibung</em>{{end}}
                  </div>
                </div>
              </div>
            {{end}}
          </div>
        </div>
      </div>
      {{else}}
      <p>Keine Termine gefunden.</p>
      {{end}}
    </div>
  </div>
</form>

<script>
  // Maintain selected calendars in a JS Set
  let selected = new Set([{{range $i, $cal := .Calendars}}{{if index $.ActiveCals $cal}}{{if $i}},{{end}}"{{$cal}}"{{end}}{{end}}]);
  function toggleCalendar(cal) {
    if (selected.has(cal)) {
      selected.delete(cal);
    } else {
      selected.add(cal);
    }
    // Update hidden input and submit
    document.getElementById('calendar-input').value = Array.from(selected).join(',');
    document.getElementById('calendar-form').submit();
  }
</script>

{{template "footer"}}
